# CPU 效能計算

## 學習目標
- 理解 CPU 執行時間的計算公式
- 掌握 CPU 效能比較的方法
- 能夠計算並比較不同處理器的效能
- 理解效能提升的計算方法

## 1. 基本概念

### 1.1 CPU 執行時間公式

CPU 執行時間是衡量處理器效能的重要指標，其計算公式為：

```
執行時間 (Execution Time) = 指令數 (Instruction Count) × CPI / 時脈頻率 (Clock Rate)
```

其中：
- **指令數 (Instruction Count)**: 程式執行所需的總指令數量
- **CPI (Cycles Per Instruction)**: 平均每條指令所需的時脈週期數
- **時脈頻率 (Clock Rate)**: CPU 的時脈頻率，單位為 Hz（如 GHz）

### 1.2 每秒執行指令數 (IPS)

另一種衡量 CPU 效能的方式是計算每秒可執行的指令數：

```
IPS (Instructions Per Second) = 時脈頻率 (Clock Rate) / CPI
```

IPS 越高，代表 CPU 效能越好。

## 2. 解題步驟

### 步驟 1: 寫出公式

首先明確寫出 CPU 執行時間的計算公式：

```
執行時間 = 指令數 × CPI / 時脈頻率
```

### 步驟 2: 計算各處理器的效能指標

依序計算各個處理器的效能指標。可以直接計算執行時間，或計算每秒可執行指令數 (IPS)。

**範例：**

假設有三個處理器：
- **P1**: 時脈 3GHz, CPI 1.5
- **P2**: 時脈 2.5GHz, CPI 1.0
- **P3**: 時脈 4GHz, CPI 2.0

**計算 IPS：**
- P1: IPS = 3 / 1.5 = 2 GIPS (每秒 2×10⁹ 個指令)
- P2: IPS = 2.5 / 1.0 = 2.5 GIPS
- P3: IPS = 4 / 2.0 = 2 GIPS

### 步驟 3: 比較結果

根據計算結果，IPS 越高代表效能越好。因此 **P2 效能最高**。

### 步驟 4: 回答延伸問題（效能提升計算）

**情境：** 將 P1, P2, P3 執行時間降低 30%，即執行時間變為原來的 70%。同時 P1, P2, P3 的 CPI 分別上升 20%，即 CPI 變為原來的 1.2 倍。

**解題過程：**

1. 建立方程式：
   ```
   新執行時間 = 0.7 × 原執行時間
   ```

2. 代入公式：
   ```
   指令數 × (1.2 × 原CPI) / 新時脈 = 0.7 × (指令數 × 原CPI / 原時脈)
   ```

3. 簡化：
   ```
   1.2 / 新時脈 = 0.7 / 原時脈
   新時脈 = (1.2 / 0.7) × 原時脈 ≈ 1.714 × 原時脈
   ```

4. 分別計算各處理器的新時脈：
   - P1: 新時脈 = 1.714 × 3GHz ≈ 5.14 GHz
   - P2: 新時脈 = 1.714 × 2.5GHz ≈ 4.29 GHz
   - P3: 新時脈 = 1.714 × 4GHz ≈ 6.86 GHz

## 3. 練習題

### 練習題 1

有三個處理器，其規格如下：
- **A**: 時脈 2.0 GHz, CPI 2.0
- **B**: 時脈 2.5 GHz, CPI 1.5
- **C**: 時脈 3.0 GHz, CPI 2.5

假設執行相同程式，指令數為 10⁹ 條，請：
1. 計算各處理器的 IPS
2. 計算各處理器的執行時間
3. 比較哪個處理器效能最好

**解答：**

1. **計算 IPS：**
   - A: IPS = 2.0 / 2.0 = 1.0 GIPS
   - B: IPS = 2.5 / 1.5 ≈ 1.67 GIPS
   - C: IPS = 3.0 / 2.5 = 1.2 GIPS

2. **計算執行時間：**
   - A: 執行時間 = 10⁹ × 2.0 / (2.0 × 10⁹) = 1.0 秒
   - B: 執行時間 = 10⁹ × 1.5 / (2.5 × 10⁹) = 0.6 秒
   - C: 執行時間 = 10⁹ × 2.5 / (3.0 × 10⁹) ≈ 0.83 秒

3. **比較結果：** B 處理器效能最好（執行時間最短，IPS 最高）

### 練習題 2

處理器 X 的時脈為 2.0 GHz，CPI 為 1.8。若要使執行時間降低 25%，且 CPI 上升 15%，請問新的時脈應該是多少？

**解答：**

新執行時間 = 0.75 × 原執行時間
新 CPI = 1.15 × 原 CPI

```
指令數 × (1.15 × 1.8) / 新時脈 = 0.75 × (指令數 × 1.8 / 2.0)
1.15 × 1.8 / 新時脈 = 0.75 × 1.8 / 2.0
2.07 / 新時脈 = 0.675
新時脈 = 2.07 / 0.675 ≈ 3.07 GHz
```

## 4. 重要觀念整理

### 4.1 影響 CPU 效能的因素

1. **時脈頻率**: 頻率越高，理論上執行速度越快
2. **CPI**: 平均每條指令的週期數，越小越好
3. **指令數**: 程式所需的指令總數，與演算法和編譯器優化有關

### 4.2 效能優化策略

- **提高時脈頻率**: 但會增加功耗和發熱
- **降低 CPI**: 透過指令管線化、分支預測等技術
- **減少指令數**: 透過更好的演算法和編譯器優化

### 4.3 常見單位換算

- 1 GHz = 10⁹ Hz
- 1 GIPS = 10⁹ IPS (每秒十億條指令)

## 5. 考試重點提醒

1. **務必寫出公式**：即使題目沒有明確要求，也要先寫出計算公式
2. **單位要一致**：確保所有數值的單位一致（如都用 GHz 或都用 Hz）
3. **計算要仔細**：CPI 和時脈的關係容易搞混，要特別注意
4. **比較要明確**：在比較多個處理器時，要明確指出哪個效能最好，並說明理由
