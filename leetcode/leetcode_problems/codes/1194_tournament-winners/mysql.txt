# Write your MySQL query statement below
WITH PlayerScores AS (
    SELECT 
        player_id,
        SUM(score) AS total_score
    FROM (
        SELECT 
            first_player AS player_id,
            first_score AS score
        FROM Matches
        UNION ALL
        SELECT 
            second_player AS player_id,
            second_score AS score
        FROM Matches
    ) all_scores
    GROUP BY player_id
),
RankedPlayers AS (
    SELECT 
        g.group_id,
        ps.player_id,
        ps.total_score,
        ROW_NUMBER() OVER (
            PARTITION BY g.group_id 
            ORDER BY ps.total_score DESC, ps.player_id ASC
        ) AS rnk
    FROM Players p
    JOIN Groups g ON p.player_id = g.player_id
    JOIN PlayerScores ps ON p.player_id = ps.player_id
)
SELECT 
    group_id,
    player_id
FROM RankedPlayers
WHERE rnk = 1
ORDER BY group_id;
