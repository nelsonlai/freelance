# Write your MySQL query statement below
WITH ApprovedTransactions AS (
    SELECT 
        DATE_FORMAT(trans_date, '%Y-%m') AS month,
        country,
        COUNT(*) AS approved_count,
        SUM(amount) AS approved_amount
    FROM Transactions
    WHERE state = 'approved'
    GROUP BY month, country
),
ChargebackTransactions AS (
    SELECT 
        DATE_FORMAT(c.trans_date, '%Y-%m') AS month,
        t.country,
        COUNT(*) AS chargeback_count,
        SUM(t.amount) AS chargeback_amount
    FROM Chargebacks c
    JOIN Transactions t ON c.trans_id = t.id
    GROUP BY month, t.country
)
SELECT 
    COALESCE(a.month, c.month) AS month,
    COALESCE(a.country, c.country) AS country,
    COALESCE(a.approved_count, 0) AS approved_count,
    COALESCE(a.approved_amount, 0) AS approved_amount,
    COALESCE(c.chargeback_count, 0) AS chargeback_count,
    COALESCE(c.chargeback_amount, 0) AS chargeback_amount
FROM ApprovedTransactions a
LEFT JOIN ChargebackTransactions c 
    ON a.month = c.month AND a.country = c.country
UNION
SELECT 
    c.month,
    c.country,
    COALESCE(a.approved_count, 0) AS approved_count,
    COALESCE(a.approved_amount, 0) AS approved_amount,
    c.chargeback_count,
    c.chargeback_amount
FROM ChargebackTransactions c
LEFT JOIN ApprovedTransactions a 
    ON c.month = a.month AND c.country = a.country
WHERE a.month IS NULL
ORDER BY month, country;
