{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/OneDrive/Desktop/cat%20project%202026/Jan%2023%202026/fp_fixed%20%281%29/src/app/match-result/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"./match-result.css\";\nimport Link from \"next/link\";\nimport ReactMarkdown from \"react-markdown\";\n\ninterface CatProfile {\n  name: string;\n  breed: string;\n  age: number;\n  gender?: string;\n  health: string;\n  vaccinations: string[];\n  photo_path?: string;\n}\n\nexport default function MatchResultPage() {\n  const [myCat, setMyCat] = useState<CatProfile | null>(null);\n  const [matches, setMatches] = useState<{ cat: CatProfile; score: number }[]>([]);\n  const [matchIdx, setMatchIdx] = useState(0);\n  const [review, setReview] = useState<string>(\"\");\n  const [userEmail, setUserEmail] = useState<string>(\"\");\n  const [loading, setLoading] = useState(true);\n  const [progress, setProgress] = useState(0);\n  const [loadingStage, setLoadingStage] = useState(\"ÂàùÂßãÂåñ...\");\n  const [kittenImageUrl, setKittenImageUrl] = useState<string>(\"\");\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"auth_token\") || \"\";\n    if (!token) {\n      window.location.href = \"/login\";\n      return;\n    }\n\n    const API_BASE = process.env.NEXT_PUBLIC_API_BASE || \"http://localhost:5050\";\n\n    // Ê®°Êì¨ËºâÂÖ•ÈÄ≤Â∫¶\n    const progressInterval = setInterval(() => {\n      setProgress((prev) => {\n        if (prev >= 90) return prev; // ÂÅúÂú® 90% Á≠âÂæÖÂØ¶ÈöõÊï∏Êìö\n        return prev + Math.random() * 15;\n      });\n    }, 300);\n\n    (async () => {\n      try {\n        setLoadingStage(\"Ê≠£Âú®ÈÄ£Êé•‰º∫ÊúçÂô®...\");\n        setProgress(10);\n\n        const res = await fetch(`${API_BASE}/api/match-result`, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n\n        setLoadingStage(\"Ê≠£Âú®Êé•Êî∂Êï∏Êìö...\");\n        setProgress(50);\n\n        const json = await res.json().catch(() => ({}));\n        \n        if (!res.ok) {\n          clearInterval(progressInterval);\n          alert(json?.message || \"Failed to load match result.\");\n          return;\n        }\n\n        setLoadingStage(\"Ê≠£Âú®ÂàÜÊûêÈÖçÂ∞çÁµêÊûú...\");\n        setProgress(70);\n\n        setUserEmail(json?.user?.email || \"\");\n        setMyCat(json?.your_feline || null);\n        \n        const MAX_CHARS = 600;\n        let text = json?.match_review || \"\";\n        if (text.length > MAX_CHARS) {\n          text = text.slice(0, MAX_CHARS) + \"‚Ä¶\";\n        }\n        setReview(text);\n\n        setLoadingStage(\"Ê≠£Âú®Ê∫ñÂÇôÈ°ØÁ§∫...\");\n        setProgress(90);\n\n        setMatches(Array.isArray(json?.potential_matches) ? json.potential_matches : []);\n        setMatchIdx(0);\n        \n        // üé® Ë®≠ÂÆöÂ∞èË≤ìÂúñÁâá URL\n        if (json?.kitten_image_url) {\n          setKittenImageUrl(json.kitten_image_url);\n        }\n\n        // ÂÆåÊàêËºâÂÖ•\n        setTimeout(() => {\n          setProgress(100);\n          setLoadingStage(\"ÂÆåÊàêÔºÅ\");\n          setTimeout(() => {\n            setLoading(false);\n            clearInterval(progressInterval);\n          }, 300);\n        }, 200);\n\n      } catch (err) {\n        clearInterval(progressInterval);\n        console.error(err);\n        alert(\"Something went wrong loading match data.\");\n        setLoading(false);\n      }\n    })();\n\n    return () => clearInterval(progressInterval);\n  }, []);\n\n  const handleBack = () => window.history.back();\n\n  const API_BASE = process.env.NEXT_PUBLIC_API_BASE || \"http://localhost:5050\";\n  const currentMatch = matches.length ? matches[Math.min(matchIdx, matches.length - 1)] : null;\n  const matchCat = currentMatch?.cat || null;\n  \n  const nextMatch = () => {\n    if (!matches.length) return;\n    setMatchIdx((i) => (i + 1) % matches.length);\n  };\n  \n  const prevMatch = () => {\n    if (!matches.length) return;\n    setMatchIdx((i) => (i - 1 + matches.length) % matches.length);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"loading-page\">\n        <div className=\"loading-container\">\n          <div className=\"spinner\"></div>\n          <h2 style={{ marginBottom: '8px', color: '#333' }}>ËºâÂÖ•ÈÖçÂ∞çÁµêÊûú‰∏≠...</h2>\n          <p style={{ marginBottom: '24px', color: '#777' }}>{loadingStage}</p>\n          \n          <div className=\"progress-bar-container\">\n            <div className=\"progress-bar\" style={{ width: `${progress}%` }}></div>\n          </div>\n          \n          <p style={{ marginTop: '12px', fontSize: '0.9rem', color: '#999' }}>\n            {Math.round(progress)}% ÂÆåÊàê\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"match-result-page\">\n      <header className=\"header\">\n        <Link href=\"/\" className=\"back-btn\">\n          ‚Üê Back to Home\n        </Link>\n\n        <div className=\"logo\">\n          üêæ <span>PawMatch</span>\n        </div>\n\n        <div className=\"head-titles\">\n          <h1>Feline Compatibility Analysis</h1>\n          <p>Find the purrfect partner for your beloved cat üíû</p>\n        </div>\n      </header>\n\n      <main>\n        <div className=\"top-row\">\n          <section className=\"card\">\n            <h2>Your Feline</h2>\n\n            {myCat ? (\n              <div className=\"cat-info\">\n                <div className=\"cat-photo\">\n                  <img\n                    src={(myCat.photo_path ? `${API_BASE}${myCat.photo_path}` : \"/images/your_cat.jpg\")}\n                    alt={myCat.name}\n                  />\n                </div>\n                <ul>\n                  <li><b>Owner:</b> {userEmail || \"-\"}</li>\n                  <li><b>Name:</b> {myCat.name}</li>\n                  <li><b>Breed:</b> {myCat.breed}</li>\n                  <li><b>Age:</b> {myCat.age}</li>\n                  <li><b>Gender:</b> {myCat.gender || \"-\"}</li>\n                  <li><b>Health:</b> {myCat.health}</li>\n                  <li><b>Vaccinations:</b> {(myCat.vaccinations || []).join(\", \")}</li>\n                </ul>\n              </div>\n            ) : (\n              <p className=\"desc\">Loading your cat profile...</p>\n            )}\n\n            <p className=\"desc\">\n              Your cat's data helps PawMatch find their best match.\n            </p>\n          </section>\n\n          <section className=\"card\">\n            <h2>Potential Match</h2>\n            <div className=\"match-info\">\n              <div className=\"match-photo\">\n                <button className=\"arrow left\" onClick={prevMatch} type=\"button\">‚Üê</button>\n                <img\n                  src={(matchCat?.photo_path ? `${API_BASE}${matchCat.photo_path}` : \"/images/match_cat.jpg\")}\n                  alt=\"Potential Match\"\n                />\n                <button className=\"arrow right\" onClick={nextMatch} type=\"button\">‚Üí</button>\n              </div>\n              <ul>\n                {matchCat ? (\n                  <>\n                    <li><b>Score:</b> {currentMatch?.score ?? 0}</li>\n                    <li><b>Name:</b> {matchCat.name}</li>\n                    <li><b>Breed:</b> {matchCat.breed}</li>\n                    <li><b>Age:</b> {matchCat.age} years</li>\n                    <li><b>Gender:</b> {matchCat.gender || \"-\"}</li>\n                    <li><b>Health:</b> {matchCat.health}</li>\n                    <li><b>Vaccinations:</b> {(matchCat.vaccinations || []).join(\", \")}</li>\n                  </>\n                ) : (\n                  <li>No other cats in database yet.</li>\n                )}\n              </ul>\n            </div>\n            <p className=\"desc\">\n              Browse more compatible cats analyzed by PawMatch AI using the arrows.\n            </p>\n          </section>\n        </div>\n\n        <section className=\"match-review\">\n          <h2>Match Review</h2>\n          <p className=\"caption\">\n            AI-generated preview ‚Äî possible kitten appearance üß°\n          </p>\n\n          <div className=\"kitten-photo\">\n            <img\n              src={\n                kittenImageUrl\n                  ? `${API_BASE}${kittenImageUrl}`\n                  : \"https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400\"\n              }\n              alt=\"AI Kitten\"\n              onError={(e) => {\n                e.currentTarget.src =\n                  \"https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400\";\n              }}\n            />\n          </div>\n\n          <div className=\"ai-review\">\n            {review ? (\n              <ReactMarkdown>{review}</ReactMarkdown>\n            ) : (\n              <p className=\"muted\">\n                AI review is not available yet.\n              </p>\n            )}\n          </div>\n        </section>\n\n        <div className=\"actions\">\n            <a\n            href=\"https://docs.google.com/forms/d/e/1FAIpQLScPPwaHDG4b_HV-rFNSyjcdy31ESjHCbuKeIfb7w-Bn292KgQ/viewform\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"share\"\n            >\n            üì§ Share Result\n            </a>\n        </div>\n      </main>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}